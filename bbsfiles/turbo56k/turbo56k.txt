Turbo56K v0.8

Turbo56K was created by Jorge Castillo as a simple protocol to provide high speed file transfer functionality to his bit-banging 57600bps RS232 routine for the Commodore 64.

Over time, the protocol has been extended to include 4-bit PCM audio streaming, bitmap graphics transfer and display, SID and PSG music streaming and more.

A typical Turbo56K command sequence consists of a command start character (CMDON: $FF) followed by the command itself (a character with it's 7th bit set) and and any parameters if required.

The sequence ends with the command end character (CMDOFF : $FE)

Some commands will exit command mode automatically without needing a CMDOFF character, but is good practice to include it anyway.

For example the following byte sequence enters command mode, sets the screen to Hires mode on page 0 with blue border and then exits command mode:

$FF $90 $00 $06 $FE




- Reserved Characters

$FF : Enters command mode

$FE : Exits command mode



- Commands

-- Data Transfer

$80: Sets the memory pointer for the next transfer
Parameters:
Destination Address : 2 bytes : low - high

$81: Selects preset address for the next transfer
Parameters:
Preset Number : 1 byte

$82: Start a memory transfer
Parameters:
Transfer Size : 2 bytes : low - high

$83: Starts audio streaming until receiving a `$00` character

$84: Starts chiptune streaming until receiving a data block with size 0, or interrupted by the user

$85: (New v0.6) Sets the stream and write order of the registers for SID streaming
Parameters
Stream : 25 bytes

$86: (New v0.7) Starts a file transfer (to be saved on a storage device client side)




-- Graphics Mode

$90: Returns to the default text mode
Parameters:
Page Number : 1 byte
Border Color : 1 byte
Background Color : 1 byte

$91: Switches to hi-res bitmap mode (C-64 and Plus/4) or Screen2 mode (MSX)
Parameters:
Page Number : 1 byte
Border Color : 1 byte

$92: Switches to multicolor bitmap mode (C-64 and Plus/4 only)
Parameters:
Page Number : 1 byte
Border Color : 1 byte
Background Color : 1 byte
Multicolor 3 color : 1 byte (only for Plus/4)




-- Drawing Primitives

$98: (New v0.8) Clears graphic screen

$99: (New v0.8) Set pen Color
Parameters:
Pen Number: 1 byte
Color index: 1 byte

$9A: (New v0.8) Plot point
Parameters:
Pen Number: 1 byte
X coordinate: 2 bytes
Y coordinate: 2 bytes

$9B: (New v0.8) Line
Parameters:
Pen Number: 1 byte
X1: 2 bytes
Y1: 2 bytes
X2: 2 bytes
Y2: 2 bytes

$9C: (New v0.8) Box
Parameters: 
Pen Number: 1 byte
X1: 2 bytes
Y1: 2 bytes
X2: 2 bytes
Y2: 2 bytes
Fill: 1 byte

$9D: (New v0.8) Circle/Ellipse
Parameters:
Pen Number: 1 byte
X: 2 bytes
Y: 2 bytes
r1: 2 bytes
r2: 2bytes

$9E: (New v0.8) Fill
Parameters:
Pen Number: 1 byte
X: 2 bytes
Y: 2 bytes




-- Connection Management

$A0: Selects the screen as the output for the received characters, exits command mode

$A1: Selects the optional hardware voice synthesizer as the output for the received characters, exits command mode.
(Valid only for the microsint + rs232 / Wi-Fi board)

$A2: Request terminal ID and version

$A3: (New v0.6) Query if the command passed as parameter is implemented in the terminal.
If the returned value has its 7th bit clear then the value is the number of parameters required by the command (Max 8 in the current Retroterm implementation).
If the 7th bit is set the command is not implemented.

$A4: (New v0.8) Query the client's setup. The single byte parameter indicates which 'subsystem' is being queried. Client must reply with at least 1 byte indicating the reply length. Zero meaning not implemented. See below for the subsystem parameters.



-- Screen Management

$B0: Moves the text cursor
Parameters:
Column : 1 byte
Row : 1 byte

Exits command mode

$B1: Fills a text screen row with a given character, text cursor is not moved
Parameters:
Screen Row : 1 byte
Fill Character : 1 byte (C-64 or Plus/4 Screen Code, MSX character map code)

$B2: Enables or disables the text cursor
Parameters:
Enable : 1 byte

$B3: Screen split
Parameters:
Modes : 1 byte
 Bit 0 - 4 : Split Row
 Bit 7 : Bitmap Graphics Mode in top section
  0 : Hires
  1 : Multicolor
  (Ignored on MSX)
Background Color : 1 byte
 Bit 0 - 3 : Top Section
 Bit 4 - 7 : Bottom Section

$B4: (New v0.7) Get text cursor position, returns 2 characters, column and row.

$B5: Set text window
Parameters:
Top Row : 1 byte
Bottom Row : 1 byte

$B6: (New v0.7) Scroll the text window up or down x rows
Parameters:
Row count: 1 byte -128/+127

$B7: (New v0.7) Set ink color
Parameters:
Color index: 1 byte


-- Preset Addresses

For command $81

Commodore 64 & Plus/4

$00: Text page 0
$10: Bitmap page 0
$20: Color RAM

The current versions of Retroterm support only a single text / bitmap page.
Values other than 0 for bits 0 - 3 will be ignored.

MSX1

$00: Text/name table page 0
$10: Pattern table page 0
$20: Color table

Any other value will set the address to $4000 (RAM Page 1) -Subject to changes-



--- "Subsystems"

For command $A4

Subsystem $00: Platform/Refresh rate

Reply length: 2 bytes

Byte 0: Packet length = 1
Byte 1: bits 0-6: platform
        bit 7: Refresh rate

---- Platform:

 0: C64
 1: Plus/4
 2: MSX
 3: (reserved) C128
 4: (reserved) VIC20
 5: (reserved) ZX Spectrum
 6: (reserved) Atari
 7: (reserved) Apple II
 8: (reserved) Amstrad
 9: (reserved) Amiga
10: (reserved) PET


--- Refresh rate:

0: 50Hz
1: 60Hz


Subsystem $01: Text screen size

Reply length: 3 bytes

Byte 0: Packet length = 2
Byte 1: Columns
Byte 2: Rows


Sybsystem $02: Bit rate

Reply length: 2 bytes

Byte 0: Packet length = 1
Byte 1: 0: Network
        1: 300bps
        2: 600bps
        3: 1200bps
        4: 1800bps
        5: 2400bps
        6: 4800bps
        7: 9600bps
        8: 19200bps
        9: 28800bps
        10: 38400bps
        11: 57600bps
        12: 76800bps
        13: 115200bps


Subsystem $03: RAM size

Reply length: 3 bytes

Byte 0: Packet lenght = 2
Bytes 1-2: RAM size in Kilobytes (little-endian)


Sybsystem $04: VRAM size

Reply length: 3 bytes

Byte 0: Packet length = 2
Bytes 1-2: VRAM size in Kilobytes (little-endian)


Subsystem $05: Graphic modes (platform dependent)

Reply length: 2 bytes

Byte 0: Packet length 1
Byte 1: Graphic modes available


---- C64:

In addition to Hires and Multicolour

bit 0: FLI
bit 1: AFLI


---- C128:

In addition to Hires and Multicolour

bit 0: FLI
bit 1: AFLI
bit 2: VDC
bit 3: VDCI

---- MSX:

In addition to Screen2

bit 0: Screen 3
bit 1: Screen 4
bit 2: Screen 5
bit 3: Screen 6
bit 4: Screen 7
bit 5: Screen 8
bit 6: Screen 10
bit 7: Screen 12

---- Amiga:

bit 0: OCS
bit 1: ECS
bit 2: AGA

Subsystem $06: Audio (platform dependent)

Reply length: 3 bytes

Byte 0: Packet length 2
Byte 1: Synthesizers
Byte 2: PCM

---- Synthesizers

-----Commodore 64/128

bits 0-3: Installed SID(s)-1
bit 4: OPL present
bit 5: microSynth present
bit 6: Magic Voice present

-----MSX

bit 0: MSX Audio present
bit 1: MSX Music present
bit 2: OPL3 present

---- PCM

bits 0-1: bits per sample (1(PWM)/4/8/16)
bit 2: Channels (1/2)
bit 3: Connection speed dependent sample rate
bit 4: 11025Hz sample rate
bit 5: 16000Hz sample rate
bit 6: 22050Hz sample rate
bit 7: Delta compression
